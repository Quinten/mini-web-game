(()=>{var e=Object.freeze({addIcons:e=>{let t=document.createElement("canvas");t.width=1024,t.height=1024;let a=t.getContext("2d");e?e(a):(a.fillStyle="white",a.fillRect(0,0,1024,1024),a.fillStyle="lightblue",a.fillRect(256,256,512,512));let s=t.toDataURL(),r=document.createElement("link");r.rel="icon",r.type="image/png",r.href=s,document.head.appendChild(r);let c=document.createElement("link");c.rel="apple-touch-icon",c.href=s,document.head.appendChild(c);let o=document.title,n=document.querySelector("[name=description]").getAttribute("content"),d=document.body.style.background,l=document.createElement("meta");l.name="theme-color",l.content=d,document.head.appendChild(l);let i=window.location.href,p=i.replace(/[^/]+$/,""),h=[{src:s,type:"image/png",sizes:"1024x1024"}],m=document.createElement("link");m.rel="manifest",m.href="data:application/json,"+JSON.stringify({name:o,short_name:o,description:n,background_color:d,theme_color:d,display:"standalone",start_url:i,scope:p,icons:h}),document.head.appendChild(m)}});let t=["preupdate","update","postupdate","predraw","draw","postdraw"],a={preupdate:["preupdate"],update:["update"],postupdate:["postupdate"],predraw:["presave","pretransform","predraw"],draw:["save","transform","draw","restore"],postdraw:["postdraw","postrestore"]},s=e=>{let{ctx:t}=e;t.save()},r=e=>{let{ctx:t}=e;t.restore()},c={draw:{save:s,restore:r},transform:{save:s,restore:r},predraw:{presave:s,postrestore:r},pretransform:{presave:s,postrestore:r},postdraw:{presave:s,postrestore:r}},o={},n=()=>{t.forEach(e=>{o[e]={}}),Object.keys(a).forEach(e=>{a[e].forEach(e=>{o[e]={}})})};n();var d=Object.freeze({systems:o,systemTypes:t,subsystemTypes:a,addComponents:(e,s)=>{let r={canvas:void 0,ctx:void 0};return Object.keys(e).forEach(t=>{void 0!==e[t].canvas&&(r.canvas=e[t].canvas,r.ctx=r.canvas.getContext("2d"))}),void 0!==r.canvas||s||(["predraw","draw","postdraw"].forEach(e=>{t.splice(t.indexOf(e),1)}),n()),Object.keys(e).forEach(s=>{t.forEach(t=>{void 0!==e[s][t]&&(o[t][s]=e[s][t],void 0!==c[t]&&Object.keys(c[t]).forEach(e=>{void 0===o[e][s]&&(o[e][s]=c[t][e])}))}),Object.keys(a).forEach(t=>{a[t].forEach(t=>{void 0!==e[s][t]&&(o[t][s]=e[s][t],void 0!==c[t]&&Object.keys(c[t]).forEach(a=>{void 0===e[s][a]&&(o[a][s]=c[t][a])}))})})}),r}}),l=Object.freeze({game:(t,a,s)=>{e.addIcons(s);let{systems:r,systemTypes:c,subsystemTypes:o,addComponents:n}=d,{canvas:l,ctx:i}=n(a),p={},h=0,m=0,f=e=>{m=e-h,h=e,c.forEach(e=>{p[e]=[]}),t.system.states.forEach(a=>{t[a].state.entities.forEach(s=>{let n=t[s];Object.keys(n).forEach(d=>{let h=n[d],f={entities:t,id:s,entity:n,comp:d,component:h,stateId:a,delta:m,time:e,ctx:i,canvas:l};c.forEach(e=>{o[e].forEach(t=>{void 0!==r[t][d]&&p[e].push({system:r[t][d],c:f})})})})})}),c.forEach(e=>{p[e].forEach(e=>{let{system:t,c:a}=e;t(a)})}),requestAnimationFrame(f)};f(0)}});let i=["index.html"];var p=Object.freeze({start:e=>{let t=void 0===e?"mwg":e,a=e=>{let t=new Request(e,{cache:"reload"});if("cache"in t)return t;let a=new URL(e,self.location.href);return a.search+=(a.search?"&":"")+"cachebust="+Date.now(),new Request(a)};self.addEventListener("install",e=>{e.waitUntil(caches.open(t).then(e=>e.addAll(i)).then(self.skipWaiting()))}),self.addEventListener("activate",e=>{let a=[t];e.waitUntil(caches.keys().then(e=>e.filter(e=>!a.includes(e))).then(e=>Promise.all(e.map(e=>caches.delete(e)))).then(()=>self.clients.claim()))}),self.addEventListener("fetch",e=>{e.respondWith(fetch(a(e.request.url)).then(a=>(caches.open(t).then(t=>t.put(e.request.url,a.clone())),a.clone())).catch(t=>caches.match(e.request.url)))})},PRECACHE_URLS:i});let{game:h}=l,{start:m,PRECACHE_URLS:f}=Object.freeze({game:h,sw:p}).sw;f.push(...[]),m("mini-web-game")})();