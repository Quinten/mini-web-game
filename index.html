<!doctype html><html lang="en"><head><meta charset="utf-8"><title>mini-web-game</title><meta name="description" content=""><meta name="author" content="Quinten Clause"><meta name="monetization" content="$ilp.uphold.com/N3GyWXpENLq4"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"></head><body style="background:#000;color:#fff;margin:0;"> <canvas id="canvas" style="display:block;touch-action:none;user-select:none;-webkit-tap-highlight-color:transparent;"></canvas> <script type="module">var e=Object.freeze({addIcons:e=>{let t=document.createElement("canvas");t.width=1024,t.height=1024;let n=t.getContext("2d");n.fillStyle="white",n.fillRect(0,0,1024,1024),n.fillStyle="lightblue",n.fillRect(256,256,512,512);let i=t.toDataURL(),a=document.createElement("link");a.rel="icon",a.type="image/png",a.href=i,document.head.appendChild(a);let o=document.createElement("link");o.rel="apple-touch-icon",o.href=i,document.head.appendChild(o);let r=document.title,c=document.title,l=document.querySelector("[name=description]").getAttribute("content"),s=document.body.style.background,d=document.createElement("meta");d.name="theme-color",d.content=s,document.head.appendChild(d);let p=s,m=window.location.href,u=m.replace(/[^/]+$/,""),h=[{src:i,type:"image/png",sizes:"1024x1024"}],g=document.createElement("link");g.rel="manifest",g.href="data:application/json,"+JSON.stringify({name:r,short_name:c,description:l,background_color:p,theme_color:s,display:"standalone",start_url:m,scope:u,icons:h}),document.head.appendChild(g)}}),t={system:{states:["game","test"]},game:{state:{entities:["viewport","input"]}},viewport:{resize:{minWidth:256,minHeight:256}},input:{pointer:{}},player:{fillrect:{fill:"white",x:8,y:8,width:240,height:240,next:["game","testx"]},sound:{melody:["8G3","8D3","4C3"]},data:{nClicks:0}},enemy:{fillrect:{fill:"lightblue",x:8,y:8,width:240,height:240,next:["game","test"]},sound:{melody:["8C3","8D3","8G3+8"],play:!0},data:{nClicks:0}},test:{state:{entities:["player"]}},testx:{state:{entities:["enemy"]}}};let n={},i=document.title+" Data ";var a=Object.freeze({preupdate:e=>{let{id:t,entity:a}=e;if(void 0===n[t]){let e=localStorage.getItem(i+t);null!==e&&(n[t]=e,a.data=JSON.parse(e))}},postupdate:e=>{let{id:t,entity:a}=e,o=JSON.stringify(a.data);n[t]!==o&&(n[t]=o,localStorage.setItem(i+t,o))}});let o,r,c,l,s,d,p,m=0,u=(e=138)=>{if(void 0===o||"running"!==o.state){if(o=new AudioContext,/(iPhone|iPad)/i.test(navigator.userAgent)&&48e3!==o.sampleRate){let e=o.createBuffer(1,1,48e3),t=o.createBufferSource();t.buffer=e,t.connect(o.destination),t.start(0),t.disconnect(),o.close(),o=new AudioContext}c=o.createBiquadFilter(),c.connect(o.destination),c.type="lowpass",c.frequency.value=920,l=o.createGain(),l.connect(c),l.gain.value=.8,s=o.createDelay(60/e),s.delayTime.value=60/e,d=o.createGain(),d.gain.value=.25,s.connect(d),d.connect(s),p=o.createGain(),p.gain.value=.5,p.connect(l),s.connect(p),r=[0,1,2,3,4,5,6,7].map((()=>{let e=o.createGain();return e.connect(l),e.connect(s),e}))}},h=(e,t,n,i=120,a="triangle")=>{if("closed"===e.context.state)return;let o=t.split("+"),r=o[0].replace(/\d/g,""),c=o.reduce(((e,t)=>e+1/Number(t.match(/^\d+/g)[0])*240/i),0),l=o[0].match(/\d+$/g);l=l?+l[0]:4;let s="AbBCdDeEFgGa".indexOf(r);if(-1===s)return c;let d=100*s+1200*(l-4),p=e.context.createOscillator();return p.connect(e),p.frequency.value=440,p.detune.value=d,p.type=a,e.gain.setValueAtTime(0,n),e.gain.linearRampToValueAtTime(.6,n+.03*c),e.gain.setValueAtTime(.56,n+.24*c),e.gain.setValueAtTime(.55,n+.3*c),e.gain.linearRampToValueAtTime(0,n+1.5*c),p.start(n),p.stop(n+1.5*c),c};var g=Object.freeze({preupdate:e=>{let{component:t}=e;if(!t.play)return;let{melody:n,bpm:i=120,loop:a=!1,nextNote:c=0,nextNoteTick:l=o.currentTime}=t;u(i);let s=60/i*7;for(o.currentTime>l+.35&&(c=0,l=o.currentTime);l<o.currentTime+s;){let e=h(r[m],n[c],l,i);if(m=(m+1)%r.length,c=(c+1)%n.length,l+=e,0===c&&!a){t.play=!1;break}}t.nextNote=c,t.nextNoteTick=l},initCtx:u});let y=!1,f=!1;var v=Object.freeze({preupdate:e=>{!1===f&&((e=>{let t,n,i,a,o=e.component,r=e.entities.viewport.resize,c=!1,l=0,s=0,d=e=>{t=canvas.getBoundingClientRect(),n=t.left,i=t.top,a=r.zoom/window.devicePixelRatio,l=(e.clientX-n)/a,s=(e.clientY-i)/a,o.x=l,o.y=s};canvas.addEventListener("pointerdown",(e=>{!1!==e.isPrimary&&(d(e),o.downX=l,o.downY=s,o.justDown=!0,o.isDown=!0,c=!1,g.initCtx())})),canvas.addEventListener("pointermove",(e=>{!1!==e.isPrimary&&d(e)})),canvas.addEventListener("pointerup",(e=>{c?c=!1:!1!==e.isPrimary&&(d(e),o.justUp=!0,o.isDown=!1)})),canvas.addEventListener("pointerout",(e=>{o.isDown&&(o.justUp=!0,o.isDown=!1)})),canvas.addEventListener("pointerenter",(e=>{c=!0}))})(e),f=!0);let{component:t}=e;y=t.pointing,t.pointing=!1},postupdate:e=>{let{component:t}=e;t.justDown=!1,t.justUp=!1,y&&!t.pointing?canvas.style.cursor="default":!y&&t.pointing&&(canvas.style.cursor="pointer")}});let w=0,x=0,E=1,b=1,j=1,C=e=>{let{ctx:t}=e;t.restore(),t.save(),t.scale(j,j)};var k=Object.freeze({preupdate:e=>{if(w===window.innerWidth&&x===window.innerHeight)return;w=window.innerWidth,x=window.innerHeight,canvas.style.width=w+"px",canvas.style.height=x+"px",canvas.width=w*window.devicePixelRatio,canvas.height=x*window.devicePixelRatio;let{component:t}=e;E=t.minWidth/t.minHeight,b=w/x,E<b?(j=canvas.height/t.minHeight,t.width=t.minWidth*b,t.height=t.minHeight):(j=canvas.width/t.minWidth,t.width=t.minWidth,t.height=t.minHeight/b),t.zoom=j},draw:e=>{let{ctx:t}=e;C(e),t.clearRect(0,0,w,x)},flush:C});var T=Object.freeze({draw:e=>{let{ctx:t}=e,{x:n,y:i,width:a,height:o,fill:r}=e.component;t.fillStyle=r,t.fillRect(n,i,a,o)},update:e=>{let{pointer:t}=e.entities.input,{component:n,entity:i}=e,{x:a,y:o,width:r,height:c}=n;t.x<a||t.x>r+a||t.y<o||t.y>c+o||(t.pointing=!0,t.justUp&&void 0!==i.sound&&(i.sound.play=!0),t.justUp&&(void 0!==i.data&&void 0!==i.data.nClicks&&(i.data.nClicks=i.data.nClicks+1),e.entities.system.states=n.next))}}),O=Object.freeze({data:a,pointer:v,resize:k,sound:g,fillrect:T});let z={},R=["preupdate","update","postupdate","draw"];R.forEach((e=>{z[e]={}})),Object.keys(O).forEach((e=>{R.forEach((t=>{void 0!==O[e][t]&&(z[t][e]=O[e][t])}))}));var D=Object.freeze({systems:z,systemTypes:R});e.addIcons();var A;A=new URL("sw.js",import.meta.url).toString();try{"serviceWorker"in navigator&&window.addEventListener("load",(e=>{navigator.serviceWorker.register(A)}))}catch(e){}let{systems:S,systemTypes:W}=D,L={},N=canvas.getContext("2d"),P=0,G=0,H=e=>{G=e-P,P=e,W.forEach((e=>{L[e]=[]})),t.system.states.forEach((n=>{t[n].state.entities.forEach((i=>{let a=t[i];Object.keys(a).forEach((o=>{let r=a[o];W.forEach((c=>{void 0!==S[c][o]&&L[c].push({system:S[c][o],c:{entities:t,id:i,entity:a,comp:o,component:r,stateId:n,delta:G,time:e,ctx:N}})}))}))}))})),W.forEach((e=>{L[e].forEach((e=>{let{system:t,c:n}=e;t(n)}))})),requestAnimationFrame(H)};H(0);</script> </body></html>