<!doctype html><html lang="en"><head><meta charset="utf-8"><title></title><meta name="description" content><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"></head><body style="color:#fff;background:#000;margin:0"> <canvas id="canvas" style="touch-action:none;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;display:block"></canvas> <script type="module">let e,t,n,i,r,a,o;var c,l,s,d,u={},m=u={};function p(){throw Error("setTimeout has not been defined")}function h(){throw Error("clearTimeout has not been defined")}function f(e){if(c===setTimeout)return setTimeout(e,0);if((c===p||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}!function(){try{c="function"==typeof setTimeout?setTimeout:p}catch(e){c=p}try{l="function"==typeof clearTimeout?clearTimeout:h}catch(e){l=h}}();var g=[],y=!1,v=-1;function w(){y&&s&&(y=!1,s.length?g=s.concat(g):v=-1,g.length&&x())}function x(){if(!y){var e=f(w);y=!0;for(var t=g.length;t;){for(s=g,g=[];++v<t;)s&&s[v].run();v=-1,t=g.length}s=null,y=!1,function(e){if(l===clearTimeout)return clearTimeout(e);if((l===h||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}(e)}}function T(e,t){this.fun=e,this.array=t}function b(){}m.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];g.push(new T(e,t)),1!==g.length||y||f(x)},T.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={},m.on=b,m.addListener=b,m.once=b,m.off=b,m.removeListener=b,m.removeAllListeners=b,m.emit=b,m.prependListener=b,m.prependOnceListener=b,m.listeners=function(e){return[]},m.binding=function(e){throw Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(e){throw Error("process.chdir is not supported")},m.umask=function(){return 0};var E=Object.freeze({addIcons:e=>{let t=document.createElement("canvas");t.width=1024,t.height=1024;let n=t.getContext("2d");n.fillStyle="white",n.fillRect(0,0,1024,1024),n.fillStyle="lightblue",n.fillRect(256,256,512,512);let i=t.toDataURL(),r=document.createElement("link");r.rel="icon",r.type="image/png",r.href=i,document.head.appendChild(r);let a=document.createElement("link");a.rel="apple-touch-icon",a.href=i,document.head.appendChild(a);let o=void 0===u?"mwg":"Mini Web Game",c=document.title=o,l=document.querySelector("[name=description]").getAttribute("content"),s=document.body.style.background,d=document.createElement("meta");d.name="theme-color",d.content=s,document.head.appendChild(d);let m=window.location.href,p=m.replace(/[^/]+$/,""),h=[{src:i,type:"image/png",sizes:"1024x1024"}],f=document.createElement("link");f.rel="manifest",f.href="data:application/json,"+JSON.stringify({name:o,short_name:c,description:l,background_color:s,theme_color:s,display:"standalone",start_url:m,scope:p,icons:h}),document.head.appendChild(f)}}),j={system:{states:["game","test"]},game:{state:{entities:["viewport","input"]}},viewport:{resize:{minWidth:256,minHeight:256}},input:{pointer:{}},player:{fillrect:{fill:"white",x:8,y:8,width:240,height:240,next:["game","testx"]},sound:{melody:["8G3","8D3","4C3"]},data:{nClicks:0}},enemy:{fillrect:{fill:"lightblue",x:8,y:8,width:240,height:240,next:["game","test"]},sound:{melody:["8C3","8D3","8G3+8"],play:!0},data:{nClicks:0}},test:{state:{entities:["player"]}},testx:{state:{entities:["enemy"]}}};let k={},C=(void 0===u?"mwg":void 0)+" Data ";var O=Object.freeze({preupdate:e=>{let{id:t,entity:n}=e;if(void 0===k[t]){let e=localStorage.getItem(C+t);null!==e&&(k[t]=e,n.data=JSON.parse(e))}},postupdate:e=>{let{id:t,entity:n}=e,i=JSON.stringify(n.data);k[t]!==i&&(k[t]=i,localStorage.setItem(C+t,i))}});let z=0,A=(c=138)=>{if(void 0===e||"running"!==e.state){if(e=new AudioContext,/(iPhone|iPad)/i.test(navigator.userAgent)&&48e3!==e.sampleRate){let t=e.createBuffer(1,1,48e3),n=e.createBufferSource();n.buffer=t,n.connect(e.destination),n.start(0),n.disconnect(),e.close(),e=new AudioContext}(n=e.createBiquadFilter()).connect(e.destination),n.type="lowpass",n.frequency.value=920,(i=e.createGain()).connect(n),i.gain.value=.8,(r=e.createDelay(60/c)).delayTime.value=60/c,(a=e.createGain()).gain.value=.25,r.connect(a),a.connect(r),(o=e.createGain()).gain.value=.5,o.connect(i),r.connect(o),t=[0,1,2,3,4,5,6,7].map(()=>{let t=e.createGain();return t.connect(i),t.connect(r),t})}},L=(e,t,n,i=120,r="triangle")=>{if("closed"===e.context.state)return;let a=t.split("+"),o=a[0].replace(/\d/g,""),c=a.reduce((e,t)=>e+1/Number(t.match(/^\d+/g)[0])*240/i,0),l=a[0].match(/\d+$/g);l=l?+l[0]:4;let s="AbBCdDeEFgGa".indexOf(o);if(-1===s)return c;let d=100*s+1200*(l-4),u=e.context.createOscillator();return u.connect(e),u.frequency.value=440,u.detune.value=d,u.type=r,e.gain.setValueAtTime(0,n),e.gain.linearRampToValueAtTime(.6,n+.03*c),e.gain.setValueAtTime(.56,n+.24*c),e.gain.setValueAtTime(.55,n+.3*c),e.gain.linearRampToValueAtTime(0,n+1.5*c),u.start(n),u.stop(n+1.5*c),c};var R=Object.freeze({preupdate:n=>{let{component:i}=n;if(!i.play)return;let{melody:r,bpm:a=120,loop:o=!1,nextNote:c=0,nextNoteTick:l=e.currentTime}=i;A(a);let s=60/a*7;for(e.currentTime>l+.35&&(c=0,l=e.currentTime);l<e.currentTime+s;){let e=L(t[z],r[c],l,a);if(z=(z+1)%t.length,c=(c+1)%r.length,l+=e,0===c&&!o){i.play=!1;break}}i.nextNote=c,i.nextNoteTick=l},initCtx:A});let D=!1,S=!1,W=e=>{let t,n,i,r,a=e.component,o=e.entities.viewport.resize,c=!1,l=0,s=0,d=e=>{n=(t=canvas.getBoundingClientRect()).left,i=t.top,r=o.zoom/window.devicePixelRatio,l=(e.clientX-n)/r,s=(e.clientY-i)/r,a.x=l,a.y=s};canvas.addEventListener("pointerdown",e=>{!1!==e.isPrimary&&(d(e),a.downX=l,a.downY=s,a.justDown=!0,a.isDown=!0,c=!1,R.initCtx())}),canvas.addEventListener("pointermove",e=>{!1!==e.isPrimary&&d(e)}),canvas.addEventListener("pointerup",e=>{if(c){c=!1;return}!1!==e.isPrimary&&(d(e),a.justUp=!0,a.isDown=!1)}),canvas.addEventListener("pointerout",e=>{a.isDown&&(a.justUp=!0,a.isDown=!1)}),canvas.addEventListener("pointerenter",e=>{c=!0})};var G=Object.freeze({preupdate:e=>{!1===S&&(W(e),S=!0);let{component:t}=e;D=t.pointing,t.pointing=!1},postupdate:e=>{let{component:t}=e;t.justDown=!1,t.justUp=!1,D&&!t.pointing?canvas.style.cursor="default":!D&&t.pointing&&(canvas.style.cursor="pointer")}});let N=0,P=0,H=1,U=1,q=1,B=e=>{let{ctx:t}=e;t.restore(),t.save(),t.scale(q,q)};d=Object.freeze({data:O,pointer:G,resize:Object.freeze({preupdate:e=>{if(N===window.innerWidth&&P===window.innerHeight)return;N=window.innerWidth,P=window.innerHeight,canvas.style.width=N+"px",canvas.style.height=P+"px",canvas.width=N*window.devicePixelRatio,canvas.height=P*window.devicePixelRatio;let{component:t}=e;t.minWidth/t.minHeight<(U=N/P)?(q=canvas.height/t.minHeight,t.width=t.minWidth*U,t.height=t.minHeight):(q=canvas.width/t.minWidth,t.width=t.minWidth,t.height=t.minHeight/U),t.zoom=q},draw:e=>{let{ctx:t}=e;B(e),t.clearRect(0,0,N,P)},flush:B}),sound:R,fillrect:Object.freeze({draw:e=>{let{ctx:t}=e,{x:n,y:i,width:r,height:a,fill:o}=e.component;t.fillStyle=o,t.fillRect(n,i,r,a)},update:e=>{let{pointer:t}=e.entities.input,{component:n,entity:i}=e,{x:r,y:a,width:o,height:c}=n;t.x<r||t.x>o+r||t.y<a||t.y>c+a||(t.pointing=!0,t.justUp&&void 0!==i.sound&&(i.sound.play=!0),t.justUp&&(void 0!==i.data&&void 0!==i.data.nClicks&&(i.data.nClicks=i.data.nClicks+1),e.entities.system.states=n.next))}})});let I={},V=["preupdate","update","postupdate","draw"];V.forEach(e=>{I[e]={}}),Object.keys(d).forEach(e=>{V.forEach(t=>{void 0!==d[e][t]&&(I[t][e]=d[e][t])})});var _=Object.freeze({systems:I,systemTypes:V});E.addIcons();var F={};F=new URL("sw.js",import.meta.url).toString();try{"serviceWorker"in navigator&&window.addEventListener("load",e=>{navigator.serviceWorker.register(F)})}catch(e){}let{systems:J,systemTypes:X}=_,Y={},$=canvas.getContext("2d"),M=0,K=0,Q=e=>{K=e-M,M=e,X.forEach(e=>{Y[e]=[]}),j.system.states.forEach(t=>{j[t].state.entities.forEach(n=>{let i=j[n];Object.keys(i).forEach(r=>{let a=i[r];X.forEach(o=>{void 0!==J[o][r]&&Y[o].push({system:J[o][r],c:{entities:j,id:n,entity:i,comp:r,component:a,stateId:t,delta:K,time:e,ctx:$}})})})})}),X.forEach(e=>{Y[e].forEach(e=>{let{system:t,c:n}=e;t(n)})}),requestAnimationFrame(Q)};Q(0);</script> </body></html>