<!doctype html><html lang="en"><head><meta charset="utf-8"><title>Mini Web Game</title><meta name="description" content><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"></head><body style="color:#fff;background:#000;margin:0"> <canvas id="canvas" style="touch-action:none;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;display:block"></canvas> <script type="module">let e,t,n,i,a,r,c;let o={},l=document.title+" Data ";var s,d,m=Object.freeze({preupdate:e=>{let{id:t,entity:n}=e;if(void 0===o[t]){let e=localStorage.getItem(l+t);null!==e&&(o[t]=e,n.data=JSON.parse(e))}},postupdate:e=>{let{id:t,entity:n}=e,i=JSON.stringify(n.data);o[t]!==i&&(o[t]=i,localStorage.setItem(l+t,i))}});let p=0,u=(o=138)=>{if(void 0===e||"running"!==e.state){if(e=new AudioContext,/(iPhone|iPad)/i.test(navigator.userAgent)&&48e3!==e.sampleRate){let t=e.createBuffer(1,1,48e3),n=e.createBufferSource();n.buffer=t,n.connect(e.destination),n.start(0),n.disconnect(),e.close(),e=new AudioContext}(n=e.createBiquadFilter()).connect(e.destination),n.type="lowpass",n.frequency.value=920,(i=e.createGain()).connect(n),i.gain.value=.8,(a=e.createDelay(60/o)).delayTime.value=60/o,(r=e.createGain()).gain.value=.25,a.connect(r),r.connect(a),(c=e.createGain()).gain.value=.5,c.connect(i),a.connect(c),t=[0,1,2,3,4,5,6,7].map(()=>{let t=e.createGain();return t.connect(i),t.connect(a),t})}},h=(e,t,n,i=120,a="triangle")=>{if("closed"===e.context.state)return;let r=t.split("+"),c=r[0].replace(/\d/g,""),o=r.reduce((e,t)=>e+1/Number(t.match(/^\d+/g)[0])*240/i,0),l=r[0].match(/\d+$/g);l=l?+l[0]:4;let s="AbBCdDeEFgGa".indexOf(c);if(-1===s)return o;let d=100*s+1200*(l-4),m=e.context.createOscillator();return m.connect(e),m.frequency.value=440,m.detune.value=d,m.type=a,e.gain.setValueAtTime(0,n),e.gain.linearRampToValueAtTime(.6,n+.03*o),e.gain.setValueAtTime(.56,n+.24*o),e.gain.setValueAtTime(.55,n+.3*o),e.gain.linearRampToValueAtTime(0,n+1.5*o),m.start(n),m.stop(n+1.5*o),o};var f=Object.freeze({preupdate:n=>{let{component:i}=n;if(!i.play)return;let{melody:a,bpm:r=120,loop:c=!1,nextNote:o=0,nextNoteTick:l=e.currentTime}=i;u(r);let s=60/r*7;for(e.currentTime>l+.35&&(o=0,l=e.currentTime);l<e.currentTime+s;){let e=h(t[p],a[o],l,r);if(p=(p+1)%t.length,o=(o+1)%a.length,l+=e,0===o&&!c){i.play=!1;break}}i.nextNote=o,i.nextNoteTick=l},initCtx:u});let g=!1,v=!1,y=e=>{let t,n,i,a,r=e.component,c=e.entities.viewport.resize,o=!1,l=0,s=0,d=e=>{n=(t=canvas.getBoundingClientRect()).left,i=t.top,a=c.zoom/window.devicePixelRatio,l=(e.clientX-n)/a,s=(e.clientY-i)/a,r.x=l,r.y=s};canvas.addEventListener("pointerdown",e=>{!1!==e.isPrimary&&(d(e),r.downX=l,r.downY=s,r.justDown=!0,r.isDown=!0,o=!1,f.initCtx())}),canvas.addEventListener("pointermove",e=>{!1!==e.isPrimary&&d(e)}),canvas.addEventListener("pointerup",e=>{if(o){o=!1;return}!1!==e.isPrimary&&(d(e),r.justUp=!0,r.isDown=!1)}),canvas.addEventListener("pointerout",e=>{r.isDown&&(r.justUp=!0,r.isDown=!1)}),canvas.addEventListener("pointerenter",e=>{o=!0})};var w=Object.freeze({preupdate:e=>{!1===v&&(y(e),v=!0);let{component:t}=e;g=t.pointing,t.pointing=!1},postupdate:e=>{let{component:t}=e;t.justDown=!1,t.justUp=!1,g&&!t.pointing?canvas.style.cursor="default":!g&&t.pointing&&(canvas.style.cursor="pointer")}});let x=0,E=0,b=1,j=1,C=1,k=e=>{let{ctx:t}=e;t.restore(),t.save(),t.scale(C,C)};s=Object.freeze({data:m,pointer:w,resize:Object.freeze({preupdate:e=>{if(x===window.innerWidth&&E===window.innerHeight)return;x=window.innerWidth,E=window.innerHeight,canvas.style.width=x+"px",canvas.style.height=E+"px",canvas.width=x*window.devicePixelRatio,canvas.height=E*window.devicePixelRatio;let{component:t}=e;t.minWidth/t.minHeight<(j=x/E)?(C=canvas.height/t.minHeight,t.width=t.minWidth*j,t.height=t.minHeight):(C=canvas.width/t.minWidth,t.width=t.minWidth,t.height=t.minHeight/j),t.zoom=C},draw:e=>{let{ctx:t}=e;k(e),t.clearRect(0,0,x,E)},flush:k}),sound:f});var O=Object.freeze({fillrect:Object.freeze({draw:e=>{let{ctx:t}=e,{x:n,y:i,width:a,height:r,fill:c}=e.component;t.fillStyle=c,t.fillRect(n,i,a,r)},update:e=>{let{pointer:t}=e.entities.input,{component:n,entity:i}=e,{x:a,y:r,width:c,height:o}=n;t.x<a||t.x>c+a||t.y<r||t.y>o+r||(t.pointing=!0,t.justUp&&void 0!==i.sound&&(i.sound.play=!0),t.justUp&&(void 0!==i.data&&void 0!==i.data.nClicks&&(i.data.nClicks=i.data.nClicks+1),e.entities.system.states=n.next))}})}),z=Object.freeze({addIcons:e=>{let t=document.createElement("canvas");t.width=1024,t.height=1024;let n=t.getContext("2d");n.fillStyle="white",n.fillRect(0,0,1024,1024),n.fillStyle="lightblue",n.fillRect(256,256,512,512);let i=t.toDataURL(),a=document.createElement("link");a.rel="icon",a.type="image/png",a.href=i,document.head.appendChild(a);let r=document.createElement("link");r.rel="apple-touch-icon",r.href=i,document.head.appendChild(r);let c=document.title,o=document.querySelector("[name=description]").getAttribute("content"),l=document.body.style.background,s=document.createElement("meta");s.name="theme-color",s.content=l,document.head.appendChild(s);let d=window.location.href,m=d.replace(/[^/]+$/,""),p=[{src:i,type:"image/png",sizes:"1024x1024"}],u=document.createElement("link");u.rel="manifest",u.href="data:application/json,"+JSON.stringify({name:c,short_name:c,description:o,background_color:l,theme_color:l,display:"standalone",start_url:d,scope:m,icons:p}),document.head.appendChild(u)}});let R={},T=["preupdate","update","postupdate","draw"];T.forEach(e=>{R[e]={}});var A=Object.freeze({systems:R,systemTypes:T,addComponents:e=>{Object.keys(e).forEach(t=>{T.forEach(n=>{void 0!==e[t][n]&&(R[n][t]=e[t][n])})})}}),D=Object.freeze({game:(e,t)=>{z.addIcons();let{systems:n,systemTypes:i,addComponents:a}=A;a(t);let r={},c=canvas.getContext("2d"),o=0,l=0,s=t=>{l=t-o,o=t,i.forEach(e=>{r[e]=[]}),e.system.states.forEach(a=>{e[a].state.entities.forEach(o=>{let s=e[o];Object.keys(s).forEach(d=>{let m=s[d];i.forEach(i=>{void 0!==n[i][d]&&r[i].push({system:n[i][d],c:{entities:e,id:o,entity:s,comp:d,component:m,stateId:a,delta:l,time:t,ctx:c}})})})})}),i.forEach(e=>{r[e].forEach(e=>{let{system:t,c:n}=e;t(n)})}),requestAnimationFrame(s)};s(0)}});let L=["index.html"];var S=Object.freeze({start:e=>{let t=void 0===e?"mwg":e,n=e=>{let t=new Request(e,{cache:"reload"});if("cache"in t)return t;let n=new URL(e,self.location.href);return n.search+=(n.search?"&":"")+"cachebust="+Date.now(),new Request(n)};self.addEventListener("install",e=>{e.waitUntil(caches.open(t).then(e=>e.addAll(L)).then(self.skipWaiting()))}),self.addEventListener("activate",e=>{let n=[t];e.waitUntil(caches.keys().then(e=>e.filter(e=>!n.includes(e))).then(e=>Promise.all(e.map(e=>caches.delete(e)))).then(()=>self.clients.claim()))}),self.addEventListener("fetch",e=>{e.respondWith(fetch(n(e.request.url)).then(n=>(caches.open(t).then(t=>t.put(e.request.url,n.clone())),n.clone())).catch(t=>caches.match(e.request.url)))})},PRECACHE_URLS:L});let{game:U}=D;d=Object.freeze({game:U,sw:S});var W={};W=new URL("sw.js",import.meta.url).toString();try{"serviceWorker"in navigator&&window.addEventListener("load",e=>{navigator.serviceWorker.register(W)})}catch(e){}let q={...s,...O};d.game({system:{states:["game","test"]},game:{state:{entities:["viewport","input"]}},viewport:{resize:{minWidth:256,minHeight:256}},input:{pointer:{}},player:{fillrect:{fill:"white",x:8,y:8,width:240,height:240,next:["game","testx"]},sound:{melody:["8G3","8D3","4C3"]},data:{nClicks:0}},enemy:{fillrect:{fill:"lightblue",x:8,y:8,width:240,height:240,next:["game","test"]},sound:{melody:["8C3","8D3","8G3+8"],play:!0},data:{nClicks:0}},test:{state:{entities:["player"]}},testx:{state:{entities:["enemy"]}}},q);</script> </body></html>