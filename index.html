<!doctype html><html lang="en"><head><meta charset="utf-8"><title>Mini Web Game</title><meta name="description" content><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"></head><body style="color:#fff;background:#000;margin:0"> <canvas id="canvas" style="touch-action:none;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;display:block"></canvas> <script type="module">let e,t,n,a,i,r,o;let s={},c=document.title+" Data ";var l,d,p=Object.freeze({preupdate:e=>{let{id:t,entity:n}=e;if(void 0===s[t]){let e=localStorage.getItem(c+t);null!==e&&(s[t]=e,n.data=JSON.parse(e))}},postupdate:e=>{let{id:t,entity:n}=e,a=JSON.stringify(n.data);s[t]!==a&&(s[t]=a,localStorage.setItem(c+t,a))}});let h=0,u=(s=138)=>{if(void 0===e||"running"!==e.state){if(e=new AudioContext,/(iPhone|iPad)/i.test(navigator.userAgent)&&48e3!==e.sampleRate){let t=e.createBuffer(1,1,48e3),n=e.createBufferSource();n.buffer=t,n.connect(e.destination),n.start(0),n.disconnect(),e.close(),e=new AudioContext}(n=e.createBiquadFilter()).connect(e.destination),n.type="lowpass",n.frequency.value=920,(a=e.createGain()).connect(n),a.gain.value=.8,(i=e.createDelay(60/s)).delayTime.value=60/s,(r=e.createGain()).gain.value=.25,i.connect(r),r.connect(i),(o=e.createGain()).gain.value=.5,o.connect(a),i.connect(o),t=[0,1,2,3,4,5,6,7].map(()=>{let t=e.createGain();return t.connect(a),t.connect(i),t})}},m=(e,t,n,a=120,i="triangle")=>{if("closed"===e.context.state)return;let r=t.split("+"),o=r[0].replace(/\d/g,""),s=r.reduce((e,t)=>e+1/Number(t.match(/^\d+/g)[0])*240/a,0),c=r[0].match(/\d+$/g);c=c?+c[0]:4;let l="AbBCdDeEFgGa".indexOf(o);if(-1===l)return s;let d=100*l+1200*(c-4),p=e.context.createOscillator();return p.connect(e),p.frequency.value=440,p.detune.value=d,p.type=i,e.gain.setValueAtTime(0,n),e.gain.linearRampToValueAtTime(.6,n+.03*s),e.gain.setValueAtTime(.56,n+.24*s),e.gain.setValueAtTime(.55,n+.3*s),e.gain.linearRampToValueAtTime(0,n+1.5*s),p.start(n),p.stop(n+1.5*s),s};var f=Object.freeze({preupdate:n=>{let{component:a}=n;if(!a.play)return;let{melody:i,bpm:r=120,loop:o=!1,nextNote:s=0,nextNoteTick:c=e.currentTime}=a;u(r);let l=60/r*7;for(e.currentTime>c+.35&&(s=0,c=e.currentTime);c<e.currentTime+l;){let e=m(t[h],i[s],c,r);if(h=(h+1)%t.length,s=(s+1)%i.length,c+=e,0===s&&!o){a.play=!1;break}}a.nextNote=s,a.nextNoteTick=c},initCtx:u});let g=!1,v=!1,w=e=>{let t,n,a,i,r=e.component,o=e.entities.viewport.resize,s=!1,c=0,l=0,d=e=>{n=(t=canvas.getBoundingClientRect()).left,a=t.top,i=o.zoom/window.devicePixelRatio,c=(e.clientX-n)/i,l=(e.clientY-a)/i,r.x=c,r.y=l};canvas.addEventListener("pointerdown",e=>{!1!==e.isPrimary&&(d(e),r.downX=c,r.downY=l,r.justDown=!0,r.isDown=!0,s=!1,f.initCtx())}),canvas.addEventListener("pointermove",e=>{!1!==e.isPrimary&&d(e)}),canvas.addEventListener("pointerup",e=>{if(s){s=!1;return}!1!==e.isPrimary&&(d(e),r.justUp=!0,r.isDown=!1)}),canvas.addEventListener("pointerout",e=>{r.isDown&&(r.justUp=!0,r.isDown=!1)}),canvas.addEventListener("pointerenter",e=>{s=!0})};var y=Object.freeze({preupdate:e=>{!1===v&&(w(e),v=!0);let{component:t}=e;g=t.pointing,t.pointing=!1},postupdate:e=>{let{component:t}=e;t.justDown=!1,t.justUp=!1,g&&!t.pointing?canvas.style.cursor="default":!g&&t.pointing&&(canvas.style.cursor="pointer")}});let b=0,x=0,E=1,j=1,O=1;l=Object.freeze({data:p,pointer:y,resize:Object.freeze({preupdate:e=>{if(b===window.innerWidth&&x===window.innerHeight)return;b=window.innerWidth,x=window.innerHeight,canvas.style.width=b+"px",canvas.style.height=x+"px",canvas.width=b*window.devicePixelRatio,canvas.height=x*window.devicePixelRatio;let{component:t}=e;t.minWidth/t.minHeight<(j=b/x)?(O=canvas.height/t.minHeight,t.width=t.minWidth*j,t.height=t.minHeight):(O=canvas.width/t.minWidth,t.width=t.minWidth,t.height=t.minHeight/j),t.zoom=O,t.originX=(t.width-t.minWidth)/2,t.originY=(t.height-t.minHeight)/2},pretransform:e=>{let{ctx:t}=e;t.scale(O,O)},predraw:e=>{let{ctx:t}=e;t.clearRect(0,0,b,x)}}),sound:f});var k=Object.freeze({bulb:Object.freeze({draw:e=>{let{ctx:t}=e,{x:n,y:a,width:i,height:r,fill:o}=e.component;t.fillStyle=o,t.fillRect(n+5*i/16,a+r/2,3*i/8,r/2),t.beginPath(),t.arc(n+i/2,a+13*r/32,13*i/32,0,2*Math.PI),t.fill()},update:e=>{let{pointer:t}=e.entities.input,{component:n,entity:a}=e,{x:i,y:r,width:o,height:s}=n;t.x<i||t.x>o+i||t.y<r||t.y>s+r||(t.pointing=!0,t.justUp&&void 0!==a.sound&&(a.sound.play=!0),t.justUp&&(void 0!==a.data&&void 0!==a.data.nClicks&&(a.data.nClicks=a.data.nClicks+1),e.entities.system.states=n.next))}})}),C=Object.freeze({addIcons:e=>{let t=document.createElement("canvas");t.width=1024,t.height=1024;let n=t.getContext("2d");e?e(n):(n.fillStyle="white",n.fillRect(0,0,1024,1024),n.fillStyle="lightblue",n.fillRect(256,256,512,512));let a=t.toDataURL(),i=document.createElement("link");i.rel="icon",i.type="image/png",i.href=a,document.head.appendChild(i);let r=document.createElement("link");r.rel="apple-touch-icon",r.href=a,document.head.appendChild(r);let o=document.title,s=document.querySelector("[name=description]").getAttribute("content"),c=document.body.style.background,l=document.createElement("meta");l.name="theme-color",l.content=c,document.head.appendChild(l);let d=window.location.href,p=d.replace(/[^/]+$/,""),h=[{src:a,type:"image/png",sizes:"1024x1024"}],u=document.createElement("link");u.rel="manifest",u.href="data:application/json,"+JSON.stringify({name:o,short_name:o,description:s,background_color:c,theme_color:c,display:"standalone",start_url:d,scope:p,icons:h}),document.head.appendChild(u)}});let z=["preupdate","update","postupdate","predraw","draw","postdraw"],R={preupdate:["preupdate"],update:["update"],postupdate:["postupdate"],predraw:["presave","pretransform","predraw"],draw:["save","transform","draw","restore"],postdraw:["postdraw","postrestore"]},T=e=>{let{ctx:t}=e;t.save()},D=e=>{let{ctx:t}=e;t.restore()},P={draw:{save:T,restore:D},transform:{save:T,restore:D},predraw:{presave:T,postrestore:D},pretransform:{presave:T,postrestore:D},postdraw:{presave:T,postrestore:D}},A={};z.forEach(e=>{A[e]={}}),Object.keys(R).forEach(e=>{R[e].forEach(e=>{A[e]={}})});var L=Object.freeze({systems:A,systemTypes:z,subsystemTypes:R,addComponents:e=>{Object.keys(e).forEach(t=>{z.forEach(n=>{void 0!==e[t][n]&&(A[n][t]=e[t][n],void 0!==P[n]&&Object.keys(P[n]).forEach(e=>{void 0===A[e][t]&&(A[e][t]=P[n][e])}))}),Object.keys(R).forEach(n=>{R[n].forEach(n=>{void 0!==e[t][n]&&(A[n][t]=e[t][n],void 0!==P[n]&&Object.keys(P[n]).forEach(a=>{void 0===e[t][a]&&(A[a][t]=P[n][a])}))})})})}}),S=Object.freeze({game:(e,t,n)=>{C.addIcons(n);let{systems:a,systemTypes:i,subsystemTypes:r,addComponents:o}=L;o(t);let s={},c=canvas.getContext("2d"),l=0,d=0,p=t=>{d=t-l,l=t,i.forEach(e=>{s[e]=[]}),e.system.states.forEach(n=>{e[n].state.entities.forEach(o=>{let l=e[o];Object.keys(l).forEach(p=>{let h=l[p],u={entities:e,id:o,entity:l,comp:p,component:h,stateId:n,delta:d,time:t,ctx:c};i.forEach(e=>{r[e].forEach(t=>{void 0!==a[t][p]&&s[e].push({system:a[t][p],c:u})})})})})}),i.forEach(e=>{s[e].forEach(e=>{let{system:t,c:n}=e;t(n)})}),requestAnimationFrame(p)};p(0)}});let W=["index.html"];var U=Object.freeze({start:e=>{let t=void 0===e?"mwg":e,n=e=>{let t=new Request(e,{cache:"reload"});if("cache"in t)return t;let n=new URL(e,self.location.href);return n.search+=(n.search?"&":"")+"cachebust="+Date.now(),new Request(n)};self.addEventListener("install",e=>{e.waitUntil(caches.open(t).then(e=>e.addAll(W)).then(self.skipWaiting()))}),self.addEventListener("activate",e=>{let n=[t];e.waitUntil(caches.keys().then(e=>e.filter(e=>!n.includes(e))).then(e=>Promise.all(e.map(e=>caches.delete(e)))).then(()=>self.clients.claim()))}),self.addEventListener("fetch",e=>{e.respondWith(fetch(n(e.request.url)).then(n=>(caches.open(t).then(t=>t.put(e.request.url,n.clone())),n.clone())).catch(t=>caches.match(e.request.url)))})},PRECACHE_URLS:W});let{game:q}=S;d=Object.freeze({game:q,sw:U});var H=Object.freeze({iconDraw:e=>{e.fillStyle="white",e.fillRect(320,512,384,512),e.beginPath(),e.arc(512,416,416,0,2*Math.PI),e.fill()}}),N={};N=new URL("sw.js",import.meta.url).toString();try{"serviceWorker"in navigator&&window.addEventListener("load",e=>{navigator.serviceWorker.register(N)})}catch(e){}let G={...l,...k};d.game({system:{states:["game","test"]},game:{state:{entities:["viewport","input"]}},viewport:{resize:{minWidth:256,minHeight:256}},input:{pointer:{}},bulboff:{bulb:{fill:"gray",x:8,y:8,width:240,height:240,next:["game","testx"]},sound:{melody:["8G3","8D3","4C3"]},data:{nClicks:0}},bulbon:{bulb:{fill:"white",x:8,y:8,width:240,height:240,next:["game","test"]},sound:{melody:["8C3","8D3","8G3+8"],play:!0},data:{nClicks:0}},test:{state:{entities:["bulboff"]}},testx:{state:{entities:["bulbon"]}}},G,H.iconDraw);</script> </body></html>